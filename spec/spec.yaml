openapi: 3.0.0
servers:
  - url: 'http://petstore.swagger.io/v2'
info:
  description: >-
    This is an api spec for room reservation program.
  version: 1.0.0
  title: OpenAPI Orklas
  license:
    name: "Zlib License"
tags:
  - name: user
    description: Account to do operation on room
  - name: room
    description: Subject of reserve
  - name: classReserve
    description: Represent a single book operation of a room
  - name: schedule
    description: Possible booking time of a room
paths:
  /users:
    post:
      tags: [user]
      summary: Register a new user
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '409':
          description: Username or email already exists
  /users/special:
    post:
      tags: [user]
      summary: Register a new user with role support
      operationId: createUserSpecial
      security:
        - klas_auth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreateSpecial'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '409':
          description: Username or email already exists
  /users/login:
    post:
      tags: [user]
      summary: Authenticate user
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
  /users/logout:
    post:
      tags: [user]
      summary: Logout current user
      description: >
        Client should discard the JWT. Server may optionally blacklist token.
      operationId: logoutUser
      security:
        - klas_auth: []
      responses:
        '204':
          description: Logged out
  /users/me:
    get:
      tags: [user]
      summary: Get current authenticated user
      operationId: getCurrentUser
      security:
        - klas_auth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
  /users/{id}:
    put:
      tags: [user]
      summary: Update user
      operationId: updateUser
      security:
        - klas_auth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '403':
          description: Forbidden
        '404':
          description: User not found
  
    delete:
      tags: [user]
      summary: Delete user
      operationId: deleteUser
      security:
        - klas_auth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Deleted
  /rooms:
    post:
      tags: [room]
      summary: Create a new room
      operationId: createRoom
      security:
        - klas_auth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomCreate'
      responses:
        '201':
          description: Room created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
        '400':
          description: Validation error
        '401':
          description: Unauthenticated
        '403':
          description: Unauthorized
  
    get:
      tags: [room]
      summary: List rooms
      description: List rooms with optional filters, pagination, and sorting
      operationId: listRooms
      security:
        - klas_auth: []
      parameters:
        - name: status
          in: query
          schema:
            type: array
            items:
              $ref: '#/components/schemas/RoomStatus'
          style: form
          explode: false
  
        - name: tagIds
          in: query
          schema:
            type: array
            items:
              type: integer
              format: int64
          style: form
          explode: false
  
        - name: roomType
          in: query
          schema:
            $ref: '#/components/schemas/RoomType'
  
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
  
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
  
        - name: sort
          in: query
          description: Sort by field (prefix with - for descending)
          schema:
            type: string
            example: "-name"
  
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomListResponse'
        '400':
          description: Invalid query parameters
  /rooms/{roomId}:
    get:
      tags: [room]
      summary: Get room by ID
      operationId: getRoomById
      security:
        - klas_auth: []
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
        '400':
          description: Invalid ID
        '404':
          description: Room not found
  
    patch:
      tags: [room]
      summary: Update room fields
      operationId: updateRoom
      security:
        - klas_auth: []
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomUpdate'
      responses:
        '200':
          description: Room updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
        '400':
          description: Validation error
        '404':
          description: Room not found
  
    delete:
      tags: [room]
      summary: Delete a room
      operationId: deleteRoom
      security:
        - klas_auth: []
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Room deleted
        '404':
          description: Room not found
  /rooms/{roomId}/images:
    post:
      tags: [room]
      summary: Upload room image
      operationId: uploadRoomImage
      security:
        - klas_auth: []
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                description:
                  type: string
      responses:
        '201':
          description: Image uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomImage'
  /reservations:
    get:
      tags: [reservation]
      summary: List user reservations
      description: List active and future reservations of the authenticated user
      operationId: listMyReservations
      security:
        - klas_auth: []
      parameters:
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/ReservationStatus'
        - name: from
          in: query
          description: Filter reservations starting from this date
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationListResponse'
    post:
      tags: [reservation]
      summary: Create reservation
      description: Request a reservation for a room schedule
      operationId: createReservation
      security:
        - klas_auth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationCreate'
      responses:
        '201':
          description: Reservation created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reservation'
        '409':
          description: Schedule already reserved or overlapping
  /reservations/{reservationId}:
    delete:
      tags: [reservation]
      summary: Cancel reservation
      description: Only allowed for owner while status is waiting
      operationId: cancelReservation
      security:
        - klas_auth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Reservation cancelled
        '403':
          description: Not allowed
        '404':
          description: Reservation not found
  /reservations/{reservationId}/status:
    patch:
      tags: [reservation-admin]
      summary: Update reservation status
      description: Accept or deny a reservation (admin only)
      operationId: updateReservationStatus
      security:
        - klas_auth: []
      parameters:
        - name: reservationId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationStatusUpdate'
      responses:
        '200':
          description: Status updated
        '409':
          description: Invalid status transition
  /rooms/{roomId}/schedules:
    parameters:
      - name: roomId
        in: path
        required: true
        schema:
          type: integer
          format: int64
  
    get:
      tags: [schedule]
      summary: List room schedules
      description: Includes availability info
      operationId: listRoomSchedules
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: List of schedules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Schedule'
  
    post:
      tags: [schedule]
      summary: Create room schedule
      operationId: createSchedule
      security:
        - klas_auth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleCreate'
      responses:
        '201':
          description: Schedule created
        '409':
          description: Time overlap detected
  /schedules/{scheduleId}:
    delete:
      tags: [schedule]
      summary: Delete schedule
      description: Cannot delete schedule with accepted reservations
      operationId: deleteSchedule
      security:
        - klas_auth: []
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Schedule deleted
        '409':
          description: Schedule is reserved
  
components:
  requestBodies:
    Room:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Room'
      description: Room object
  securitySchemes:
    klas_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    UserResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        username:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        phone:
          type: string
        userStatus:
          type: integer
          format: int32
    UserCreate:
      type: object
      required: [username, email, password]
      properties:
        username:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
    UserCreateSpecial:
      type: object
      required: [username, email, password, role]
      properties:
        username:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
        role:
          $ref: '#/components/schemas/UserRole'
    UserUpdate:
      type: object
      properties:
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
        password:
          type: string
          format: password
    LoginResponse:
      type: object
      properties:
        accessToken:
          type: string
        tokenType:
          type: string
          example: Bearer
        expiresIn:
          type: integer
          description: Token lifetime in seconds
    Room:
      title: Room
      description: A reservable room
      type: object
      required: [id, name, status, roomType, photoUrls, tagIds]
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
          minLength: 1
          maxLength: 100
        status:
          $ref: '#/components/schemas/RoomStatus'
        roomType:
          $ref: '#/components/schemas/RoomType'
        photoUrls:
          type: array
          items:
            type: string
            format: uri
        tagIds:
          type: array
          items:
            type: integer
            format: int64
    RoomUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        status:
          $ref: '#/components/schemas/RoomStatus'
        roomType:
          $ref: '#/components/schemas/RoomType'
        tagIds:
          type: array
          items:
            type: integer
            format: int64
    RoomListResponse:
      type: object
      required: [items, total]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Room'
        total:
          type: integer

    RoomCreate:
      type: object
      required: [name, roomType, tagIds]
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        roomType:
          $ref: '#/components/schemas/RoomType'
        tagIds:
          type: array
          minItems: 1
          items:
            type: integer
            format: int64
    RoomImage:
      type: object
      properties:
        id:
          type: integer
          format: int64
        url:
          type: string
          format: uri

    RoomStatus:
      title: Status of a room
      description: Status describes availablity of a room, wheter it's available to use, reserve, or neither
      type: string
      enum:
        - reserved
        - closed
        - open
    RoomType:
      title: Type of a room
      description: Yes, it's a type of a room
      type: string
      enum:
        - class
        - laboratory
        - theater
    Reservation:
      title: Reservation
      type: object
      required: [id, schedId, userId, status, createdAt]
      properties:
        id:
          type: integer
          format: int64
        schedId:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        status:
          $ref: '#/components/schemas/ReservationStatus'
        description:
          type: string
          maxLength: 500
        createdAt:
          type: string
          format: date-time
    ReservationCreate:
      type: object
      required: [schedId]
      properties:
        schedId:
          type: integer
          format: int64
        description:
          type: string
          maxLength: 500
    ReservationStatusUpdate:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [accepted, denied]
    ReservationStatus:
      type: string
      enum: [waiting, accepted, denied]
    ReservationListResponse:
      type: object
      required: [items, total]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Reservation'
        total:
          type: integer
    Schedule:
      title: Schedule
      type: object
      required: [id, roomId, startTime, endTime, isReserved]
      properties:
        id:
          type: integer
          format: int64
        roomId:
          type: integer
          format: int64
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
        isReserved:
          type: boolean
    ScheduleCreate:
      type: object
      required: [startTime, endTime]
      properties:
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
    User:
      title: a User
      description: A User who is purchasing from the pet store
      type: object
      properties:
        id:
          type: integer
          format: int64
        username:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        password:
          type: string
        phone:
          type: string
        userStatus:
          type: integer
          format: int32
          description: User Status
        role:
          $ref: '#/components/schemas/UserRole'
    
    UserRole:
      title: Role for a User
      description: Role is used to define authority of a user
      type: string
      enum:
        - student
        - lecturer
        - administrator
    Tag:
      title: Room Tag
      description: A tag for a room
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string

    ApiResponse:
      title: An uploaded response
      description: Describes the result of uploading an image resource
      type: object
      properties:
        code:
          type: integer
          format: int32
        type:
          type: string
        message:
          type: string




